<!DOCTYPE html>
<html lang="fr">
<head>
  <meta charset="UTF-8">
  <title>Autorisation Enedis</title>
  <style>
    @font-face {
      font-family: "Aptos";
      src: local("Aptos"), local("Segoe UI"), local("Helvetica Neue"), local("Arial"), sans-serif;
    }
    body {
      font-family: "Aptos", "Segoe UI", sans-serif;
      display: flex;
      flex-direction: column;
      align-items: center;
      text-align: center;
      padding: 20px;
    }
    .form-section {
      border: 1px solid #aaa;
      padding: 15px;
      margin: 10px 0;
      width: 100%;
      max-width: 600px;
    }
    .form-section h2 {
      margin-top: 0;
    }
    label {
      display: block;
      margin: 8px 0;
      text-align: left;
    }
    input[type="text"], input[type="number"], input[type="checkbox"] {
      width: 100%;
      padding: 6px;
      margin-top: 4px;
      box-sizing: border-box;
    }
    button {
      padding: 10px 20px;
      font-size: 16px;
      margin-top: 20px;
      cursor: pointer;
    }
  </style>
</head>
<body>
  <img src="localwatt logo .png" alt="Logo LocalWATT" style="max-width: 200px; margin-bottom: 10px;">
  <p><strong>Donnez votre accord pour que LocalWATT récolte vos données auprès d'Enedis.</strong></p>

  <form id="enedis-form">

    <div class="form-section">
      <h2>Signataire</h2>
      <label>Êtes-vous un représentant d'une organisation professionnelle ou publique ?</label>
      <label><input type="radio" name="estOrganisation" value="oui" required> Oui</label>
      <label><input type="radio" name="estOrganisation" value="non"> Non</label>
    </div>

    <div id="champs-organisation" class="form-section" style="display: none;">
      <h2>Informations - Organisation</h2>
      <label>Nom du signataire : <input type="text" name="nom" required></label>
      <label>Prénom du signataire : <input type="text" name="prenom" required></label>
      <label>Nom de l'organisation : <input type="text" name="organisation" required></label>
      <label>SIRET : <input type="text" name="siret" required></label>
      <label>Adresse : <input type="text" name="adresse" required></label>
      <label>Code postal : <input type="text" name="codepostal" required></label>
      <label>Commune : <input type="text" name="commune" required></label>
    </div>

    <div id="champs-individuel" class="form-section" style="display: none;">
      <h2>Informations - Particulier</h2>
      <label>Nom : <input type="text" name="nom" required></label>
      <label>Prénom : <input type="text" name="prenom" required></label>
      <label>Adresse : <input type="text" name="adresse" required></label>
      <label>Code postal : <input type="text" name="codepostal" required></label>
      <label>Commune : <input type="text" name="commune" required></label>
    </div>

    <div class="form-section">
      <h2>PDL</h2>
      <label>Point De Livraison (PDL) : <input type="text" name="pdl" required></label>
    </div>

    <div class="form-section">
      <h2>Données</h2>
      <label>
        <input type="checkbox" name="consentement" required>
        Le signataire autorise LocalWATT à récupérer les données de consommation électrique auprès d'Enedis
      </label>
      <label>
        <input type="checkbox" name="habilitation">
        Le signataire du formulaire déclare être dûment habilité par le client pour la signature du présent document.
      </label>
    </div>

    <button type="submit">Je donne mon consentement</button>
  </form>

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
  <script>
    const form = document.getElementById(\"enedis-form\");
    const organisationFields = document.getElementById(\"champs-organisation\");
    const individuelFields = document.getElementById(\"champs-individuel\");

    document.querySelectorAll('input[name="estOrganisation"]').forEach(radio => {
  radio.addEventListener("change", () => {
    if (radio.value === "oui") {
      organisationFields.style.display = "block";
      individuelFields.style.display = "none";
    } else {
      organisationFields.style.display = "none";
      individuelFields.style.display = "block";
    }
  });
});

    form.addEventListener(\"submit\", function(e) {
      e.preventDefault();
      const data = new FormData(form);
      const { jsPDF } = window.jspdf;
      const doc = new jsPDF();
      doc.setFontSize(12);
      const type = data.get(\"estOrganisation\");
      if (type === \"oui\") {
        doc.text(`Je soussigné(e) ${data.get(\"prenom\")} ${data.get(\"nom\")}, représentant(e) de l'organisation ${data.get(\"organisation\")}, SIRET ${data.get(\"siret\")}, située au ${data.get(\"adresse\")}, ${data.get(\"codepostal\")} ${data.get(\"commune\")},`, 10, 20);
      } else {
        doc.text(`Je soussigné(e) ${data.get(\"prenom\")} ${data.get(\"nom\")}, demeurant au ${data.get(\"adresse\")}, ${data.get(\"codepostal\")} ${data.get(\"commune\")},`, 10, 20);
      }
      doc.text(`autorise LocalWATT à accéder à mes données de consommation via Enedis.`, 10, 40);
      if (data.get(\"habilitation\")) {
        doc.text(`Le signataire déclare être dûment habilité par le client pour la signature du présent document.`, 10, 50);
      }
      doc.text(`Fait le : ${new Date().toLocaleDateString()}`, 10, 60);
      doc.save(\"autorisation_enedis.pdf\");
    });
  </script>
</body>
</html>
